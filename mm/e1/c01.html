<html xmlns = "http://www.w3.org/1999/xhtml">	<meta name="viewport" content="width=device-width, maximum-scale=1, minimum-scale=1, user-scalable=no"/>   <head> 	 	<meta http-equiv="content-type" content="text/html; charset=utf-8" />	<!-- polyfill -->	<script src="../inc/shim/Base64.js" type="text/javascript"></script>	<script src="../inc/shim/Base64binary.js" type="text/javascript"></script>	<script src="../inc/shim/WebAudioAPI.js" type="text/javascript"></script>	<!-- midi.js package -->	<script src="../js/midi/audioDetect.js" type="text/javascript"></script>	<script src="../js/midi/gm.js" type="text/javascript"></script>	<script src="../js/midi/loadera.js" type="text/javascript"></script>	<script src="../js/midi/plugin.audiotag.js" type="text/javascript"></script>	<script src="../js/midi/plugin.webaudio42.js" type="text/javascript"></script>	<script src="../js/midi/plugin.webmidi.js" type="text/javascript"></script>	<!-- utils -->	<script src="../js/util/dom_request_xhr.js" type="text/javascript"></script>	<script src="../js/util/dom_request_script.js" type="text/javascript"></script> 	  <script type="application/javascript">  	window.navigator.standalone;  	keyshift=3;  	octk=3;  	BW=0.9;  	kbWidth=60;  	BKX =new Array();  	KM = new Array();  	b1=0;b2=1;  	for(i=0;i<4;i++){  	 KM[10+b1] = 1+b2;  	 KM[15+b1] = 2+b2;  	KM[20+b1] = 3+b2;  	KM[25+b1] = 4+b2;  	KM[30+b1] = 5+b2;  	KM[40+b1] = 6+b2;  	KM[45+b1] = 7+b2;  	KM[50+b1] = 8+b2;  	KM[55+b1] = 9+b2;  	KM[60+b1] = 10+b2;  	KM[65+b1] = 11+b2;  	KM[70+b1] = 12+b2;    b1+=70;b2+=12;  }  	  		xy=800;  	  	//	document.addEventListener('mousemove',eett1);  keyPlay=-1;  	 ccnt=0;sss="";  	 function eett_end(e) {  	   if(keyPlay>=1)keyoff(keyPlay);  	   keyPlay=-1;  	}////////////////////////////////////////////////////////     kkAlt=new Array();kkAlt["C"]=0;kkAlt["Bb"]=-2;kkAlt["Eb"]=3;  function eett(e) {  var rect = canvasAA.getBoundingClientRect();         var x = e.touches[0].clientX-rect.left;//-document.body.offsetWidth   var y = e.touches[0].clientY-rect.top;//-document.body.offsetHeight; //s=e.type+"(x="+x+" y="+y+")"+window.innerWidth+" "+window.innerHeight;;  na1=Math.floor(x/kbWidth)+1+keyshift;   tKey=na1*10;   if(x<na1*kbWidth+kbWidth/2)na1--;//canvas.height-150,kbWidth/2, 30);//ctx.moveTo(x, canvas.height-150);//ctx.lineTo(x, canvas.height-50);//var b1 = document.getElementById("b1");x0=0;if(y<canvasAA.height-150-50){	tKey=0;}else{	if(y<canvasAA.height-150+50){		 if( BKX[na1])x0= BKX[na1];		 if(x>x0 && x<x0+(BW*kbWidth))		  tKey=na1*10+5;	}}bhh=document.body.offsetHeight;  s="tKey:"+tKey+ "y:"+y +" x:"+x+" x0:["+x0+"]";//+(bhh)+"  "+(canvas.height);  if(tKey>=10){   	     keyPlay1=KM[tKey];    //  alert(keyPlay1);     if(keyPlay1!=keyPlay){     	keyoff(keyPlay);     keyPlay=keyPlay1;    // alert(keyPlay);     keyon(keyPlay);    }  }      } function keyon(kk){ 	//alert(kk);	var delay = 0; // play one note every quarter second			var note = kk+octk*12-2+kkAlt[altkey.value]; // the MIDI note			var velocity = 127; // how hard the note hits			// play the note		//	MIDI.programChange(0,65,0);				MIDI.setVolume(0, 127);			MIDI.noteOn(0, note, velocity, 0);	//		MIDI.noteOff(0, note, delay + 0.75);	  	}	function keyoff(kk){			MIDI.noteOff(0, kk+octk*12-2+kkAlt[altkey.value],  0);	}	function ckeyon(kk){ 	//alert(kk);	var delay = 0; // play one note every quarter second			var note = kk; // the MIDI note			var velocity = 127; // how hard the note hits			// play the note		//	MIDI.programChange(0,65,0);				MIDI.setVolume(0, 127);			MIDI.noteOn(0, note, velocity, 0);	//		MIDI.noteOff(0, note, delay + 0.75);	  	}	function ckeyoff(kk){			MIDI.noteOff(0, kk,  0);	}	  window.addEventListener('orientationchange', function () {    setTimeout( draw,100);      }, true);     function draw() {    	    	const el = document.documentElement;          var canvas = document.getElementById("canvas");     canvas.width=window.innerWidth;     canvas.height=window.innerHeight-50;          if (canvas.getContext) {           var ctx = canvas.getContext("2d");     ctx.clearRect(0, 0, canvas.width, canvas.height);             ctx.fillStyle = "rgba(255,255, 255, 0.5)"; /*               ctx.fillRect (0, 0, canvas.width, xy);                for(i=0;i<=canvas.height;i+=20){        	tt=0;        	if(i==0)tt=40;        		if(i>canvas.height-40)tt=40;        	ctx.beginPath();ctx.moveTo(30, i);ctx.lineTo(100+tt, i);ctx.stroke();        	        }return;*/na=1+keyshift;na1=1+keyshift;      for(x=0;x<canvas.width;x+=kbWidth){    switch(na){    	case 1:      case 2:      case 4:      case 5:      case 6:{     BKX[na1]=x+kbWidth*(1-BW/2);      	ctx.fillStyle = "rgb(0,0,0)";      	        ctx.fillRect (x+kbWidth*(1-BW/2), canvas.height-150-30,kbWidth*BW, 30+30);         break;       }    }na++;na1++;if(na>7)na=1;      ctx.beginPath();ctx.moveTo(x, canvas.height-150);ctx.lineTo(x, canvas.height-50);ctx.stroke();}      }    }   tend=0; function load() {		instruments=new Array();	for(i=0;i<s1.options.length;i++) instruments[i]=	s1.options[i].value;	instrumentA=s1.value;;		MIDI.loadPlugin({		soundfontUrl: "./soundfont/",		instrument: instruments         ,		onprogress: function(state, progress) {			console.log(state, progress);		},		onsuccess: function() {			console.log(supports);		alert("ok");	}	});	console.log("plug ret");	draw();	 canvasAA = document.getElementById("canvas");	document.addEventListener('touchstart',eett); 	document.addEventListener('touchend',eett_end); document.addEventListener('touchmove',eett); //document.addEventListener('mousemove',mmv);};function bbb1(e){   MIDI.noteOn(0, e+48, 120, 0);}function bbb(){	var delay = 0; // play one note every quarter second			var note = octk*12-2; // the MIDI note			var velocity = 127; // how hard the note hits			// play the note			console.log(MIDI.GM.byName[instrumentA].number);			for(;note<octk*12-2+12;note++){			MIDI.setVolume(0, 127);			MIDI.noteOn(0, note, velocity, delay);			MIDI.noteOff(0, note, delay + 0.1);	    delay+=0.4;	    		}}function up(){	if(octk<8) octk++;}function down(){   if(octk>2)octk--;}function keyup(){	if(keyshift<10) keyshift++;  draw();}function keydown(){   if(keyshift>0)keyshift--;   draw();}function chage_program(){	//alert(MIDI.instruments);	instrumentA=s1.value;	//alert(MIDI.GM.byName[instrumentA].number);	MIDI.programChange(0,MIDI.GM.byName[instrumentA].number,0);	}      nlv= new Array();    nlv[90]=43; //G Z    nlv[88]=44;    nlv[65]=45; //A A    nlv[83]=46;    nlv[81]=47; //B Q    nlv[49]=48; //C 1    nlv[87]=49;    nlv[50]=50; //D 2    nlv[69]=51;    nlv[51]=52; //E 3    nlv[52]=53; //F 4    nlv[82]=54;    nlv[53]=55; //G 5    nlv[84]=56;    nlv[54]=57; //A 6    nlv[89]=58;    nlv[55]=59; //B 7    nlv[56]=60; //C 8    nlv[85]=60;    nlv[73]=61;    nlv[57]=62; //D 9     nlv[79]=63;    nlv[48]=64; //E 0	      nlv[189]=65; //F -     nlv[80]=65;  //F P    nlv[219]=66;     nlv[187]=67; //G =    nlv[221]=68;      nlv[8]=69;  //A BS   nlv[46]=70;    nlv[220]=71; //B \    nlv[13]=72;  //C CRoct=0;skey=0;dd=0;function ckeydown(ev) {	e=ev.keyCode;  if(e==16){ //shift    oct=12;     console.log(e);    return;  }  if(e==18){ //alt    oct=-12;     console.log(e);    return;  }    console.log(e);   if(nlv[e]){    //v="144,"+ (nlv[e]+oct+octa+skey)+",100";  //console.log(nlv[e]);  if(dd==0)keyon(nlv[e]-24);//+oct+octa+skey);dd=1; }}octa=0;function ckeyup(ev) {	e=ev.keyCode;	if(e==39){ //right		skey++;    return; } if(e==37){ //left		skey--;    return; }if(e==38){  //up  if(octa<15)octa+=12;   return; } if(e==40){  //down  if(octa>-15)octa-=12;   return; } if(e==16){  oct=0;   console.log(e);  return; } if(e==18){    oct=0;     console.log(e);    return;  }  //  v="128,"+ (nlv[e]+oct+octa+skey)+",100";      //console.log(nlv[e]);   if(nlv[e]	){    keyoff(nlv[e]-24);//+oct+octa+skey);  // O.send(JSON.parse(v));  //websocketConnection.send(v);   //ExampleSocket.send("abcde\n"); dd=0; }	  //  console.log(e);}  window.addEventListener('keydown',this.ckeydown,false);	window.addEventListener('keyup',this.ckeyup,false);  function mmv(e){     console.log(e.offsetX);  }  </script> </head>   <body id="b1"  onload="load()" style="position:fixed;-webkit-user-select: none" ondragstart="return false;" > 	<button style="width:100;height:50" onclick="bbb()">bbb</button><button style="width:100;height:50" onclick="up()">OUP</button><button <button style="width:100;height:50;left:300" onclick="down()">ODOWN</button><button style="width:100;height:50" onclick="keyup()">KEYUP</button><button <button style="width:100;height:50;left:300" onclick="keydown()" ondragstart="return false;">KEYDOWN</button>	<select id="altkey" >		<option>C</option>		<option>Bb</option>    <option>Eb</option>			</select><select onchange="chage_program()" id="s1"><!--<option>acoustic_grand_piano</option>                                         <option>fiddle</option>                                              <option>flute</option>                                               <option>cello</option>                                            --><option>acoustic_grand_piano</option>  <option>accordion</option>                                           <option>banjo</option>                                               <option>acoustic_bass</option>                                                                                               <option>acoustic_guitar_nylon</option>   <option>alto_sax</option>                               <option>fiddle</option>                                              <option>flute</option>                                               <option>cello</option>    <option>sitar</option>                                               <option>trumpet</option>                                           <option>viola</option>                                               <option>violin</option>  <!--                                         <option>acoustic_grand_piano</option>  <option>accordion</option>                                           <option>acoustic_bass</option>                                                                                               <option>acoustic_guitar_nylon</option>                               <option>acoustic_guitar_steel</option>                               <option>alto_sax</option>                                            <option>banjo</option>                                               <option>baritone_sax</option>                                        <option>bassoon</option>                                             <option>celesta</option>                                             <option>cello</option>                                               <option>clarinet</option>                                            <option>contrabass</option>                                          <option>distortion_guitar</option>                                   <option>electric_bass_finger</option>                                <option>electric_bass_pick</option>                                  <option>electric_guitar_clean</option>                               <option>electric_guitar_jazz</option>                                <option>electric_piano_1</option>                                    <option>english_horn</option>                                        <option>fiddle</option>                                              <option>flute</option>                                               <option>french_horn</option>                                         <option>fretless_bass</option>                                       <option>harmonica</option>                                           <option>honkytonk_piano</option>                                     <option>koto</option>                                                <option>marimba</option>                                             <option>melodic_tom</option>                                         <option>music_box</option>                                           <option>oboe</option>                                     <option>piccolo</option>                                             <option>recorder</option>                                            <option>reed_organ</option>                                          <option>rock_organ</option>                                          <option>shanai</option>                                              <option>sitar</option>                                               <option>soprano_sax</option>                                         <option>steel_drums</option>                                         <option>synth_drum</option>                                          <option>taiko_drum</option>                                          <option>tango_accordion</option>                                     <option>timpani</option>                                             <option>tinkle_bell</option>                                         <option>trombone</option>                                            <option>trumpet</option>                                           <option>tuba</option>                                                <option>tubular_bells</option>                                       <option>vibraphone</option>                                          <option>viola</option>                                               <option>violin</option>  --></select>	<br>   <canvas id="canvas"  width="600" height="810"  style="position:absolute;"   ondragstart="return false;"></canvas>          </body></html>